[typesugar] Loaded config from /Users/deapovey/src/typesugar/tsconfig.json
[typesugar] Program has 78 files
[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
[typesugar] Loaded config from /Users/deapovey/src/typesugar/tsconfig.json
[typesugar] Program has 78 files

 RUN  v3.2.4 /Users/deapovey/src/typesugar

Sourcemap for "/Users/deapovey/src/typesugar/packages/core/dist/index.js" points to missing source files
 âœ“ |@typesugar/transformer| tests/pipeline-e2e.test.ts (28 tests) 10739ms
   âœ“ Pipeline E2E: HKT syntax > transforms F<_> parameter and F<A> usages  638ms
   âœ“ Pipeline E2E: HKT syntax > transforms HKT in type aliases  413ms
   âœ“ Pipeline E2E: HKT syntax > preserves non-HKT generics untouched  372ms
   âœ“ Pipeline E2E: pipe operator > transforms |> to __binop__ calls  433ms
   âœ“ Pipeline E2E: pipe operator > handles chained pipe operators  360ms
   âœ“ Pipeline E2E: pipe operator > preserves code without pipe operators  346ms
   âœ“ Pipeline E2E: cons operator > transforms :: to __binop__ calls  379ms
   âœ“ Pipeline E2E: cons operator > handles nested cons expressions  355ms
   âœ“ Pipeline E2E: source map accuracy > produces a source map for transformed files  394ms
   âœ“ Pipeline E2E: source map accuracy > provides identity mapping for untransformed files  369ms
   âœ“ Pipeline E2E: source map accuracy > maps positions for pipe-transformed code  412ms
   âœ“ Pipeline E2E: source map accuracy > maps 'result' identifier position through transformation  392ms
   âœ“ Pipeline E2E: source map accuracy > maps positions for HKT-transformed code  379ms
   âœ“ Pipeline E2E: multi-file project > transforms both files correctly  405ms
   âœ“ Pipeline E2E: multi-file project > transforms all files via transformAll()  366ms
   âœ“ Pipeline E2E: multi-file project > detects dependencies between files  381ms
   âœ“ Pipeline E2E: multi-file project > handles mixed transformed and untransformed files  527ms
   âœ“ Pipeline E2E: cache invalidation > returns cached result on repeated transforms  613ms
   âœ“ Pipeline E2E: cache invalidation > returns fresh result after invalidation  662ms
   âœ“ Pipeline E2E: cache invalidation > invalidateAll resets everything  653ms
   âœ“ Pipeline E2E: cache invalidation > tracks cache statistics  464ms
   âœ“ Pipeline E2E: edge cases > handles files with only comments  619ms
   âœ“ Pipeline E2E: edge cases > handles code with all three custom operators  487ms
   âœ“ Pipeline E2E: edge cases > getProgram() returns a valid ts.Program  314ms
stdout | tests/language-service.test.ts > Language Service Plugin > init() > returns a create function
[typesugar] Language service plugin v2 (transform-first) initializing...

stdout | tests/language-service.test.ts > Language Service Plugin > create() > returns a language service proxy
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json

stdout | tests/language-service.test.ts > Language Service Plugin > create() > logs initialization messages
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json

stdout | tests/language-service.test.ts > Language Service Plugin > host interception > modifies the original host getScriptSnapshot
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json

stdout | tests/language-service.test.ts > Language Service Plugin > host interception > modifies the original host getScriptVersion
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json

stdout | tests/language-service.test.ts > Language Service Plugin > host interception > returns transformed content for files that need transformation
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] tryTransformImplicitsCall: __binop__, registered=false
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Preprocessed: yes
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

 âœ“ |@typesugar/transformer| tests/derive-advanced.test.ts (28 tests) 12230ms
   âœ“ Sum type derivation > @derive(Eq) on discriminated union generates sum-type equality with switch  635ms
   âœ“ Sum type derivation > @derive(Show) on discriminated union generates sum-type show with switch  421ms
   âœ“ Sum type derivation > extracts correct discriminant field from union using _tag  377ms
   âœ“ Sum type derivation > sum type derive detected as kind sum in typeInfo  392ms
   âœ“ Builtin auto-derivation > @derive(Eq) on interface generates eq instance and registers it  350ms
   âœ“ Builtin auto-derivation > @derive(Show) generates show instance code  363ms
   âœ“ Builtin auto-derivation > @derive(Ord) generates comparison instance code  376ms
   âœ“ Builtin auto-derivation > @derive(Hash) generates hash instance code  342ms
   âœ“ Builtin auto-derivation > multiple derives in one decorator all register instances  358ms
   âœ“ Derive argument dependency sorting > sorts Ord after Eq when both present (via expandAfter)  375ms
   âœ“ Derive argument dependency sorting > sorts Monoid after Semigroup when both present (via expandAfter)  384ms
   âœ“ Derive argument dependency sorting > preserves original order when no dependencies exist  384ms
   âœ“ Derive argument dependency sorting > handles diamond dependencies without cycles  363ms
   âœ“ Derive argument dependency sorting > falls back to original order on cyclic dependencies  395ms
   âœ“ Primitive type alias detection > @derive on primitive type alias detects kind as primitive  404ms
   âœ“ Primitive type alias detection > @derive on non-primitive interface is detected as product  385ms
   âœ“ Recursive type detection > @derive on recursive type sets isRecursive flag  432ms
   âœ“ Recursive type detection > @derive on non-recursive type does not set isRecursive  709ms
   âœ“ Unknown derive import suggestions > reports error for unknown derive name  554ms
   âœ“ Unknown derive import suggestions > error message includes derive name and resolution paths tried  831ms
   âœ“ {Name}TC convention macros > falls through to {Name}TC when no direct derive or builtin match  456ms
   âœ“ {Name}TC convention macros > prefers direct derive macro over {Name}TC convention  657ms
   âœ“ Decorator stripping > strips @derive decorator from interface output  494ms
   âœ“ Decorator stripping > strips @derive decorator from type alias output  370ms
   âœ“ Derive edge cases > @derive on class works  364ms
   âœ“ Derive edge cases > @derive with non-identifier argument reports error  306ms
   âœ“ Derive edge cases > derive macro expansion failure reports error gracefully  346ms
   âœ“ Derive edge cases > @derive on type alias with product type works  401ms
stdout | tests/language-service.test.ts > Language Service Plugin > host interception > returns original content for files that don't need transformation
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Language Service Plugin > host interception > adds version marker for transformed files
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] tryTransformImplicitsCall: __binop__, registered=false
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Preprocessed: yes
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Language Service Plugin > diagnostics mapping > returns diagnostics from the language service
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Language Service Plugin > diagnostics mapping > maps diagnostic positions back to original for transformed files
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] tryTransformImplicitsCall: __binop__, registered=false
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Preprocessed: yes
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Language Service Plugin > completion mapping > returns completions at position
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Language Service Plugin > quick info mapping > returns quick info at position
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Language Service Plugin > definition mapping > returns definitions at position
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

 âœ“ |@typesugar/transformer| tests/operator-rewrite.test.ts (6 tests) 2475ms
   âœ“ Typeclass operator rewriting > rewrites a + b to Numeric.add(a, b) for typed operands  588ms
   âœ“ Typeclass operator rewriting > rewrites a === b to Eq.equals(a, b) for typed operands  397ms
   âœ“ Typeclass operator rewriting > rewrites a < b to Ord.compare(a, b) for typed operands  388ms
   âœ“ Typeclass operator rewriting > leaves plain number + number alone when no typeclass registered  385ms
   âœ“ Typeclass operator rewriting > reports ambiguity when two typeclasses provide same operator  358ms
   âœ“ Typeclass operator rewriting > does not rewrite operators for types without instances  358ms
stdout | tests/language-service.test.ts > Error Suppression > diagnostics in generated code > suppresses diagnostics that cannot be mapped
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] tryTransformImplicitsCall: __binop__, registered=false
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Preprocessed: yes
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > VS Code Simulation > simulates VS Code scenario: LS created before plugin
Diagnostics BEFORE plugin (should have errors for |>): 2
Serving transformed content: declare function __binop__<T, R>(value: T, op: string, fn: (x: T) => R): R;
const result = __binop__(1, "|>", ((x) => x + 1));
Diagnostics AFTER plugin modification: 0
Transform call count: 1

stdout | tests/language-service.test.ts > VS Code Simulation > creates new LS after modifying host (works)
Diagnostics with modified host from start: 0

stdout | tests/language-service.test.ts > Preprocessing via Language Service Plugin > transforms pipe operator in diagnostics
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] tryTransformImplicitsCall: __binop__, registered=false
[typesugar] tryTransformImplicitsCall: __binop__, registered=false
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Preprocessed: yes
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Preprocessing via Language Service Plugin > transforms HKT syntax
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Preprocessed: yes
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Diagnostic Position Mapping > maps diagnostic positions back to original source
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] tryTransformImplicitsCall: __binop__, registered=false
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Preprocessed: yes
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Diagnostic Position Mapping > preserves diagnostic for type error on first line
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Completions in Transformed Code > provides completions for object properties
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Completions in Transformed Code > provides completions in code alongside pipe operators
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] tryTransformImplicitsCall: __binop__, registered=false
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Preprocessed: yes
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

stdout | tests/language-service.test.ts > Transform-First Analysis > TypeScript sees transformed content > analyzes transformed code without pipe operator syntax errors
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] tryTransformImplicitsCall: __binop__, registered=false
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Preprocessed: yes
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0
Transformed content: // Declare __binop__ so transformed code is valid
declare function __binop__<T, R>(value: T, op: string, fn: (x: T) => R): R;
const result = __binop__(1, "|>", ((x) => x + 1));

Diagnostics: []

stdout | tests/language-service.test.ts > Transform-First Analysis > TypeScript sees transformed content > returns proper types for transformed expressions
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] tryTransformImplicitsCall: __binop__, registered=false
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Preprocessed: yes
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0
Quick info: undefined
Original pos: 77
Transformed pos: 76

 âœ“ |@typesugar/transformer| tests/auto-specialize.test.ts (10 tests) 4115ms
   âœ“ Auto-specialization > auto-specializes fn(instance, args) when instance is registered  549ms
   âœ“ Auto-specialization > reuses cached specialization for same call in same block  414ms
   âœ“ Auto-specialization > skips auto-specialization when @no-specialize comment is present  392ms
   âœ“ Auto-specialization > suppresses warnings with @no-specialize-warn but still skips unresolvable  383ms
   âœ“ Auto-specialization > falls back gracefully when function body is not resolvable  400ms
   âœ“ Auto-specialization > does not auto-specialize when no arguments are registered instances  363ms
   âœ“ Auto-specialization > handles multiple instance arguments  370ms
   âœ“ Auto-specialization > works with function declarations (not just arrow functions)  414ms
   âœ“ Return-type-driven specialization > specializes Result->Option by rewriting ok/err calls  424ms
   âœ“ Return-type-driven specialization > does not specialize when return type matches contextual type  405ms
stdout | tests/language-service.test.ts > Transform-First Analysis > verifies LS uses modified host > calls the modified getScriptSnapshot during analysis
[typesugar] Language service plugin v2 (transform-first) initializing...
[typesugar] Creating language service proxy for project: /test/tsconfig.json
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /test/index.ts
[typesugar] Transformed /test/index.ts (changed: true)
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0

 âœ“ |@typesugar/transformer| tests/language-service.test.ts (34 tests) 8854ms
   âœ“ Language Service Plugin > host interception > returns transformed content for files that need transformation  547ms
   âœ“ Language Service Plugin > host interception > returns original content for files that don't need transformation  398ms
   âœ“ Language Service Plugin > host interception > adds version marker for transformed files  319ms
   âœ“ Language Service Plugin > diagnostics mapping > returns diagnostics from the language service  349ms
   âœ“ Language Service Plugin > diagnostics mapping > maps diagnostic positions back to original for transformed files  387ms
   âœ“ Language Service Plugin > completion mapping > returns completions at position  376ms
   âœ“ Language Service Plugin > quick info mapping > returns quick info at position  340ms
   âœ“ Language Service Plugin > definition mapping > returns definitions at position  357ms
   âœ“ TransformationPipeline integration > transform result > includes position mapper  363ms
   âœ“ TransformationPipeline integration > transform result > includes changed flag  369ms
   âœ“ TransformationPipeline integration > transform result > sets changed to false for unchanged files  406ms
   âœ“ Position Mapping > pipe operator transformation > maps positions correctly after pipe transformation  323ms
   âœ“ Position Mapping > pipe operator transformation > handles multi-line transformations  327ms
   âœ“ Position Mapping > HKT syntax transformation > maps positions correctly after HKT transformation  386ms
   âœ“ Error Suppression > diagnostics in generated code > suppresses diagnostics that cannot be mapped  341ms
   âœ“ Preprocessing via Language Service Plugin > transforms pipe operator in diagnostics  350ms
   âœ“ Preprocessing via Language Service Plugin > transforms HKT syntax  348ms
   âœ“ Diagnostic Position Mapping > maps diagnostic positions back to original source  374ms
   âœ“ Diagnostic Position Mapping > preserves diagnostic for type error on first line  327ms
   âœ“ Completions in Transformed Code > provides completions for object properties  340ms
   âœ“ Completions in Transformed Code > provides completions in code alongside pipe operators  372ms
   âœ“ Transform-First Analysis > TypeScript sees transformed content > analyzes transformed code without pipe operator syntax errors  349ms
   âœ“ Transform-First Analysis > TypeScript sees transformed content > returns proper types for transformed expressions  376ms
   âœ“ Transform-First Analysis > verifies LS uses modified host > calls the modified getScriptSnapshot during analysis  410ms
stdout | tests/implicits.test.ts > @implicits basic resolution > fills missing Ord<T> parameter when calling sortImplicit(numbers)
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: implicits
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /Users/deapovey/src/typesugar/implicits-basic.ts
[typesugar] Expanding attribute macro: implicits
[typesugar] Entering @implicits function: sortImplicit (1 implicit params)
[typesugar] tryTransformImplicitsCall: sort, registered=false
[typesugar] tryTransformImplicitsCall: sortImplicit, registered=true
[typesugar] Filling implicit parameters for call: sortImplicit()
[typesugar] tryTransformImplicitsCall: sortImplicit, registered=true
[typesugar] Transformed /Users/deapovey/src/typesugar/implicits-basic.ts (changed: true)
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0
=== OUTPUT CODE ===
declare function sort<T>(items: T[], ord: Ord<T>): T[];
declare interface Ord<T> {
    compare(a: T, b: T): number;
}
declare const ordNumber: Ord<number>;
function sortImplicit<T>(items: T[], ord: Ord<T>): T[] {
    return sort(items, ord);
}
const numbers: number[] = [3, 1, 2];
const result = sortImplicit(numbers, Ord.summon<number>("number"));

=== DIAGNOSTICS ===
[]

 âœ“ |@typesugar/transformer| tests/specialize-extension.test.ts (5 tests) 2663ms
   âœ“ fn.specialize(dict) extension method > rewrites fn.specialize(dict) to a specialized function  560ms
   âœ“ fn.specialize(dict) extension method > leaves non-callable receiver alone (not rewritten)  521ms
   âœ“ fn.specialize(dict) extension method > reports error when no dict args provided  523ms
   âœ“ fn.specialize(dict) extension method > falls back to partial application for unregistered dicts with a warning  567ms
   âœ“ fn.specialize(dict) extension method > handles multiple dict arguments  489ms
 âœ“ |@typesugar/transformer| tests/implicits.test.ts (8 tests) 3471ms
   âœ“ @implicits basic resolution > fills missing Ord<T> parameter when calling sortImplicit(numbers)  615ms
   âœ“ @implicits basic resolution > does not modify call when all arguments are already provided  599ms
   âœ“ @implicits nested propagation > propagates implicit scope from outer to inner @implicits call  534ms
   âœ“ @implicits scope shadowing > inner scope shadows outer scope for same typeclass+type  455ms
   âœ“ @implicits error reporting > reports error when no instance is available for implicit param  485ms
   âœ“ @implicits opt-out > use no typesugar skips @implicits decorator processing  438ms
   âœ“ @implicits decorator stripping > removes @implicits decorator from the output function  342ms
 âœ“ |@typesugar/transformer| tests/import-cleanup.test.ts (9 tests) 11938ms
   âœ“ Macro import cleanup > full import removal > should remove an import when all specifiers are macros  513ms
   âœ“ Macro import cleanup > full import removal > should remove an import with renamed macro specifier  383ms
   âœ“ Macro import cleanup > partial import trimming > should keep non-macro specifiers when trimming  362ms
   âœ“ Macro import cleanup > partial import trimming > should handle mixed macro and non-macro with rename  472ms
   âœ“ Macro import cleanup > side-effect imports > should never remove side-effect-only imports  404ms
   âœ“ Macro import cleanup > non-macro imports > should leave non-macro imports untouched  374ms
   âœ“ Macro import cleanup > unused macro imports (no call) > should keep macro imports that are imported but never called  8645ms
   âœ“ Macro import cleanup > multiple macro calls > should remove import even when macro is called multiple times  426ms
   âœ“ Macro import cleanup > multiple import declarations > should handle multiple imports independently  356ms
 â¯ |@typesugar/transformer| tests/hkt-declaration.test.ts (7 tests | 1 failed) 11637ms
   âœ“ HKT F<_> declaration transformation > rewrites interface with F<_> type parameter  576ms
   âœ“ HKT F<_> declaration transformation > rewrites type alias with F<_> type parameter  431ms
   âœ“ HKT F<_> declaration transformation > leaves declarations without <_> annotation alone  394ms
   Ã— HKT F<_> declaration transformation > handles multiple type params where only some are HKT 8676ms
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
   âœ“ HKT F<_> declaration transformation > handles method signatures with HKT parameters  495ms
   âœ“ HKT F<_> declaration transformation > works alongside preprocessor without double-rewrite  726ms
   âœ“ HKT F<_> declaration transformation > handles property signatures with HKT types  338ms
 âœ“ |@typesugar/transformer| tests/infra.test.ts (17 tests) 1611ms
   âœ“ Expansion tracking > records expansions when trackExpansions is enabled  495ms
   âœ“ Expansion tracking > does not record expansions when tracking is disabled  344ms
   âœ“ Expansion tracking > tracks source file and position information  346ms
   âœ“ Config propagation > transformer factory accepts config options  422ms
 âœ“ |@typesugar/transformer| tests/pipeline.test.ts (12 tests) 2772ms
   âœ“ TransformationPipeline > transformCode (single-file) > preprocesses HKT syntax  495ms
   âœ“ TransformationPipeline > transformCode (single-file) > transforms pipe operator  357ms
   âœ“ TransformationPipeline > transformCode (single-file) > returns unchanged flag when no transformation needed  339ms
   âœ“ TransformationPipeline > transformCode (single-file) > handles syntax errors gracefully  342ms
   âœ“ TransformationPipeline > source map composition > provides a position mapper  361ms
   âœ“ TransformationPipeline > source map composition > maps positions for unchanged files  334ms
 âœ“ |@typesugar/transformer| tests/source-map-utils.test.ts (17 tests) 5ms
 âœ“ |@typesugar/transformer| tests/cache.test.ts (20 tests) 4ms
stdout | tests/debug-auto-spec.test.ts > Debug auto-specialize > check registry and transform
isRegistered: true
methods: {"brand":"Array","methods":{}}
[typesugar] Creating TypeScript program with 1 files
[typesugar] Initializing transformer
[typesugar] Registered macros: invariant, unreachable, debugOnly, comptime, registerExtensions, registerExtension, specialize, specialize$, mono, inlineCall, summon, extend, __binop__, ops, pipe, compose, typeInfo, fieldNames, validator, summonHKT, derive, implicit, summonAll, staticAssert, compileError, compileWarning, cfg, config.when, includeStr, includeBytes, includeJson, includeText, collectTypes, moduleIndex, typeclass, instance, deriving, operators, operator, reflect, implicits, Generic, cfgAttr, config.when, tailrec, verifyLaws, Eq, Ord, Clone, Debug, Hash, Default, Json, Builder, TypeGuard, ShowTC, EqTC, OrdTC, HashTC, FunctorTC
[typesugar] Expansion cache loaded: 0 entries
[typesugar] Processing: /Users/deapovey/src/typesugar/auto-spec-debug.ts
[typesugar] tryTransformImplicitsCall: double, registered=false
[typesugar] Auto-specializing call to double with instance: arrayFunctor
[typesugar] Created hoisted specialization: __typemacro___double_Array_0__
[typesugar] Hoisted 1 specialized function(s) to local scope
[typesugar] Transformed /Users/deapovey/src/typesugar/auto-spec-debug.ts (changed: true)
[typesugar]   Dependencies: 0
[typesugar]   Diagnostics: 0
=== CODE ===
const __typemacro___double_Array_0__ = /*#__PURE__*/ (xs: number[]) => xs.map((x: number) => x * 2);
declare const arrayFunctor: any;
const double = (F: {
    map(fa: any, f: any): any;
}, xs: number[]) => F.map(xs, (x: number) => x * 2);
const result = __typemacro___double_Array_0__([1, 2, 3]);

=== DIAGS ===
[]

 âœ“ |@typesugar/transformer| tests/debug-auto-spec.test.ts (1 test) 533ms
   âœ“ Debug auto-specialize > check registry and transform  533ms
 âœ“ |@typesugar/transformer| tests/position-mapper.test.ts (14 tests) 3ms

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 1 â¯â¯â¯â¯â¯â¯â¯

 FAIL  |@typesugar/transformer| tests/hkt-declaration.test.ts > HKT F<_> declaration transformation > handles multiple type params where only some are HKT
Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 â¯ tests/hkt-declaration.test.ts:64:3
     62|   });
     63| 
     64|   it("handles multiple type params where only some are HKT", () => {
       |   ^
     65|     const code = `
     66| interface MapLike<F<_>, K> {

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯


 Test Files  1 failed | 14 passed (15)
      Tests  1 failed | 215 passed (216)
   Start at  22:13:27
   Duration  41.24s (transform 438ms, setup 0ms, collect 4.80s, tests 73.05s, environment 2ms, prepare 1.07s)

JSON report written to /Users/deapovey/src/typesugar/.vitest-results/test-results.json
